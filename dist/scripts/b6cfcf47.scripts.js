"use strict";angular.module("recyclefunWebApp",["ngCookies","FacebookProvider"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/login",{templateUrl:"views/auth/login.html",controller:"LoginCtrl"}).when("/logout",{templateUrl:"views/auth/logout.html",controller:"LogoutCtrl"}).when("/register",{templateUrl:"views/auth/register.html",controller:"RegisterCtrl"}).when("/forget-password",{templateUrl:"views/auth/forget-password.html",controller:"MainCtrl"}).when("/reset-password",{templateUrl:"views/auth/reset-password.html",controller:"MainCtrl"}).when("/user/",{templateUrl:"views/user/view.html",controller:"UserProfileCtrl"}).when("/user/profile",{templateUrl:"views/user/view.html",controller:"UserProfileCtrl"}).when("/user/edit",{templateUrl:"views/user/edit.html",controller:"UserEditCtrl"}).when("/user/settings",{templateUrl:"views/user/settings.html",controller:"UserSettingsCtrl"}).when("/user/badges",{templateUrl:"views/user/badges.html",controller:"UserBadgesCtrl"}).when("/user/notifications",{templateUrl:"views/user/notifications.html",controller:"UserNotificationsCtrl"}).when("/user/:userid",{templateUrl:"views/user/view.html",controller:"UserProfileCtrl"}).when("/leaderboard",{templateUrl:"views/leaderboard.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("recyclefunWebApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=[1,2,3]}]),angular.module("recyclefunWebApp").controller("ApplicationCtrl",["$http","$location","$scope","$rootScope","$timeout","Facebook",function(a,b,c,d,e,f){window.location.href.indexOf("localhost")>0?(d._app={url:{api:jQuery.url().attr("protocol")+"://"+"api.recyclefun.localhost/"}},"undefined"!=typeof f&&f.init({appId:"516418235114060",channelUrl:"/channel.html",status:!0,cookie:!0,xfbml:!0,permissions:"read_stream, publish_stream, email"})):(d._app={url:{api:jQuery.url().attr("protocol")+"://"+"recyclefun-api.ap01.aws.af.cm/"}},"undefined"!=typeof f&&f.init({appId:"637970952903072",channelUrl:"/channel.html",status:!0,cookie:!0,xfbml:!0,permissions:"read_stream, publish_stream, email"})),c.FBLogin=function(){f.login()},d.$on("event.fb.auth.login",function(b,c){var e=c.authResponse;a({method:"GET",withCredentials:!0,url:d._app.url.api+"auth/",params:{accessToken:e.accessToken,type:"Facebook",fb_userID:e.userID}}).success(function(a){d.auth=a,console.log("$rootScope.auth",d.auth)}).error(function(){})}),d.GetAuth=function(){a({method:"GET",withCredentials:!0,url:d._app.url.api+"auth/",params:{}}).success(function(a){d.auth=a}).error(function(a){console.warn(a)})},c.$watch("auth",function(){if(d.auth&&d.auth.user){console.log("Welcome "+d.auth.user.name.display_name);var a=["/login","/register"];console.log(a),a.indexOf(b.path())>-1&&b.path("/user/profile")}}),c.Login=function(){var b=this;return b.loginForm.$valid&&a({method:"POST",withCredentials:!0,url:d._app.url.api+"auth/login",data:{identity:b.loginForm.inputEmail.$modelValue,password:b.loginForm.inputPassword.$modelValue,remember:b.loginForm.inputRemember.$modelValue}}).success(function(){d.GetAuth()}).error(function(a){b.loginForm._errorMessage=a.message}),!1},function(){d.GetAuth()}()}]).controller("FacebookCtrl",function(){}),angular.module("recyclefunWebApp").controller("LoginCtrl",["$rootScope",function(a){a.GetAuth()}]).controller("RegisterCtrl",["$http","$rootScope","$scope",function(a,b,c){b.GetAuth(),c.Register=function(){var d=this;return jQuery("form[name=registerForm]").valid()?(a({method:"POST",withCredentials:!0,url:b._app.url.api+"auth/register",data:c.regFrm}).success(function(){b.GetAuth()}).error(function(a){console.warn(a),console.log(d,d),d.registerForm._errorMessage=a.message}),void 0):!1},c.InitializePage=function(){jQuery("form[name=registerForm]").validate({rules:{email:{required:!0,email:!0},password:{minlength:8,required:!0},confirmPassword:{equalTo:"[name=password]"}},highlight:function(a){jQuery(a).closest(".form-group").removeClass("has-success").addClass("has-error")},success:function(a){jQuery(a).html('<i class="icon-ok"></i>').addClass("valid").closest(".form-group").removeClass("has-error").addClass("has-success")}})},function(){c.InitializePage()}()}]).controller("LogoutCtrl",["$http","$location","$scope","$rootScope",function(a,b,c,d){c.Logout=function(){a({method:"GET",withCredentials:!0,url:d._app.url.api+"auth/logout"}).success(function(){d.auth={},b.path("/")}).error(function(a){console.warn(a)})},c.Logout()}]),angular.module("recyclefunWebApp").controller("UserProfileCtrl",["$http","$scope","$rootScope","$routeParams",function(a,b,c,d){b.IsPageOwner=function(){return d.userid?void 0:!0},b.GetUser=function(){a({method:"GET",withCredentials:!0,url:c._app.url.api+"user",params:{user_id:d.userid}}).success(function(a){b.user=a.data}).error(function(a){console.warn(a)})},b.GetUser(),Morris.Donut({element:"donut-example",data:[{label:"Paper",value:6},{label:"Can",value:3},{label:"Glass",value:7},{label:"Plastic",value:4},{label:"Cloth",value:4},{label:"Garden",value:2},{label:"misc",value:1}]}),Morris.Bar({element:"bar-example",data:[{y:"April",a:5,b:40},{y:"May",a:4,b:65},{y:"Jun",a:6,b:40},{y:"July",a:7,b:65},{y:"Aug",a:9,b:90}],xkey:"y",ykeys:["a"],labels:["Series A"]})}]).controller("UserSettingsCtrl",["$http","$scope","$rootScope",function(a,b,c){b.user={},b._loading={GetUserSettings:!0,SaveUserSettings:!1},b.GetUserSettings=function(){b._loading.GetUserSettings=!0,a({method:"GET",withCredentials:!0,url:c._app.url.api+"user"}).success(function(a){b._loading.GetUserSettings=!1,b.user=a.data}).error(function(a){console.warn(a)})},b.SaveUserSettings=function(){b._loading.SaveUserSettings=!0,a({method:"POST",withCredentials:!0,url:c._app.url.api+"user",data:b.user}).success(function(){b._loading.SaveUserSettings=!1,alert("Settings saved.")}).error(function(a){console.warn(a)})},function(){b.GetUserSettings()}()}]).controller("UserBadgesCtrl",function(){}).controller("UserNotificationsCtrl",function(){});var app_provider=angular.module("FacebookProvider",[]);app_provider.factory("Facebook",["$rootScope",function(a){var b={};return b.permissions="read_stream, publish_stream, email",b.channelUrl="/channel.html",b.status=!0,b.cookie=!0,b.xfbml=!0,{init:function(a){angular.extend(b,a),window.fbAsyncInit=function(){FB.init({appId:b.appId,channelUrl:b.channelUrl,status:b.status,cookie:b.cookie,xfbml:b.xfbml})},function(a){var b,c="facebook-jssdk",d=a.getElementsByTagName("script")[0];a.getElementById(c)||(b=a.createElement("script"),b.id=c,b.async=!0,b.src="//connect.facebook.net/en_US/all.js",d.parentNode.insertBefore(b,d))}(document)},getLoginStatus:function(){FB.getLoginStatus(function(b){a.$broadcast("event.fb.auth.statusChange",{status:b.status})},!0)},login:function(){FB.getLoginStatus(function(c){switch(c.status){case"connected":a.$broadcast("event.fb.auth.login",{authResponse:c.authResponse});break;case"not_authorized":FB.login(function(b){b.authResponse?a.$broadcast("event.fb.auth.login",{facebook_id:b.authResponse.userID,userNotAuthorized:!0}):a.$broadcast("event.fb.auth.login.failed")},{scope:b.permissions});break;default:FB.login(function(b){b.authResponse?(a.$broadcast("event.fb.auth.login",{facebook_id:b.authResponse.userID}),a.$broadcast("event.fb.auth.authResponseChange")):a.$broadcast("event.fb.auth.login.failed")})}},!0)},logout:function(){FB.logout(function(b){b?a.$broadcast("event.fb.auth.logout"):a.$broadcast("event.fb.auth.logout.failed")})},unsubscribe:function(){FB.api("/me/permissions","DELETE",function(){a.$broadcast("event.fb.auth.authResponseChange")})}}}]);